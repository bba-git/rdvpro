# Cursor Context for RDVPro PoC (Supabase Version)

## ğŸ§­ Project Purpose
Develop a proof of concept (PoC) for the rdvpro platform using **only Supabase**:
- Supabase Auth (email/password login)
- Supabase Postgres database
- Audit logging through a custom `audit_log` table
- NestJS modular backend architecture

Strict compliance with:
- Modular code organization
- TDD (Test-Driven Development)
- DTO validation
- Secure logging

## ğŸ§± Technology Stack
- **Framework**: NestJS (Node.js)
- **Database**: Supabase Postgres
- **Authentication**: Supabase Auth (JWT tokens)
- **Audit Logs**: Insert into `audit_log` table
- **Testing**: Jest (unit and integration tests)
- **Monitoring**: Manual through audit logs (no Grafana)

## ğŸ“‚ Folder Structure
```
/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ auth/
â”‚   â”‚   â”œâ”€â”€ auth.module.ts
â”‚   â”‚   â”œâ”€â”€ auth.service.ts
â”‚   â”‚   â”œâ”€â”€ auth.controller.ts
â”‚   â”‚   â”œâ”€â”€ auth.service.spec.ts
â”‚   â”‚   â”œâ”€â”€ dto/
â”‚   â”‚   â”‚   â””â”€â”€ login.dto.ts
â”‚   â”‚   â””â”€â”€ guards/
â”‚   â”‚       â””â”€â”€ roles.guard.ts
â”‚   â””â”€â”€ supabase/
â”‚       â”œâ”€â”€ supabase.module.ts
â”‚       â””â”€â”€ audit-log.service.ts
â”‚
â”œâ”€â”€ configs/
â”‚   â”œâ”€â”€ .cursorcontext.md
â”‚   â”œâ”€â”€ .cursorrules-prompts.md
â”‚   â””â”€â”€ common-prompts.md
â”‚
â”œâ”€â”€ docs/
â”‚   â”œâ”€â”€ architecture.mermaid
â”‚   â”œâ”€â”€ technical.md
â”‚   â”œâ”€â”€ security.md
â”‚   â”œâ”€â”€ status.md
â”‚   â””â”€â”€ tasks.md
â”œâ”€â”€ .cursorrules
â”œâ”€â”€ README.md
```

## ğŸ” Security & Compliance
- All login attempts must be logged (success and failure) in `audit_log`
- All endpoints must use DTO validation (`class-validator`)
- Authorization based on user roles via custom Guard (`roles.guard.ts`)
- No sensitive data leaked into logs
- No hardcoded API keys (use environment variables)

## ğŸ§ª Testing Strategy
- TDD mandatory: tests before implementation
- Mock external services (SupabaseClient, AuditLogService)
- Unit tests cover both success and failure scenarios
- Tests live in `*.spec.ts` files next to services

## ğŸ“ˆ Deployment Notes
- Environment Variables:
  - `SUPABASE_URL`
  - `SUPABASE_KEY`
- Initial database schema should include `audit_log` table with:
  - `user_id`, `action`, `status`, `entity`, `metadata`, `timestamp`

## ğŸ›¡ï¸ Development Principles
- Follow modular service/controller/DTO/guard structure
- Use dependency injection (DI) everywhere
- Always apply TDD unless explicitly stated otherwise
- Update `docs/status.md` after completing tasks

SYSTEM_CONTEXT: |
  You are working on the RDVPro project. Refer to the database schema described in docs/technical.md when implementing services.

---

Good Cursor usage starts with good structure ğŸš€
